<!DOCTYPE HTML>
<html>
<head>
    <title>Hamburger</title>
    <link href="bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <script src="jquery-3.1.1.min.js"></script>
    <script src="bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="hamburger.js"></script>
</head>
<body>
<div class="container">
    <div class="page-header">
        <h1>Hamburger Shop</h1>
    </div>
    <div id="newHamburger" class="jumbotron"  style="display: block;">
        <h2 class="text-center">Select the size</h2>
        <div class="row">
            <div class="col-xs-6 text-center">
                <button class="btn btn-lg btn-primary" id="selectSmallSize">Small</button>
            </div>
            <div class="col-xs-6 text-center">
                <button class="btn btn-lg btn-primary" id="selectLargeSize">Large</button>
            </div>
        </div>
    </div>
    <div id="hamburgerFilling" style="display: none;">
        <div class="row">
            <div class="col-xs-4">
                <dl class="dl-horizontal"
                    style="border-bottom: 1px solid #999; margin-bottom: 5px; padding-bottom: 5px;">
                    <dt>Size</dt>
                    <dd>Large</dd>
                    <dt>Toppings</dt>
                    <dd>1</dd>
                    <dt>Stuffings</dt>
                    <dd>2</dd>
                    <dt>Calories</dt>
                    <dd>270</dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt>Price</dt>
                    <dd>$26.73</dd>
                </dl>
            </div>
            <div class="col-xs-8 text-right">
                <button class="btn btn-lg btn-success">
                        <span class="glyphicon glyphicon-shopping-cart"
                              style="padding-right: 10px;"></span>
                    Buy It!
                </button>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-6">
                                <h4>Topping</h4>
                            </div>
                            <div class="col-xs-6 text-right">
                                <div class="btn-group">
                                    <button class="btn btn-success dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Add Topping <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">Mayo</a></li>
                                        <li><a href="#">Spice</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>1</td>
                            <td width="50%">Spice</td>
                            <td width="50%">$1.5</td>
                            <td width="auto">
                                <button class="btn btn-sm btn-danger">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-xs-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-6">
                                <h4>Stuffing</h4>
                            </div>
                            <div class="col-xs-6 text-right">
                                <div class="btn-group">
                                    <button class="btn btn-success dropdown-toggle" type="button"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Add Stuffing <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">Cheese</a></li>
                                        <li><a href="#">Salad</a></li>
                                        <li><a href="#">Potato</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>1</td>
                            <td width="50%">Salad</td>
                            <td width="50%">$3.5</td>
                            <td width="auto">
                                <button class="btn btn-sm btn-danger">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td width="50%">Cheese</td>
                            <td width="50%">$0.9</td>
                            <td width="auto">
                                <button class="btn btn-sm btn-danger">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div style="border-bottom: 1px solid #bbb; margin-bottom: 20px;"></div>
        <div class="row">
            <div class="col-xs-4 col-xs-offset-8">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label class="col-xs-8 control-label text-right" for="count">Count:</label>
                        <div class="col-xs-4">
                            <input type="number" class="form-control" id="count" value="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-8 control-label text-right" for="count">Total:</label>
                        <div class="col-xs-4 form-control-static text-center">
                            $26.73
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script language="javascript">

        var hamburger;

        document.addEventListener("DOMContentLoaded", function(){
            var listInfoBlock = document.querySelectorAll('dl > dd');

            var listAddtives = document.querySelectorAll("ul.dropdown-menu");
            var topings = listAddtives[0];
            var stuffings = listAddtives[1];

            var tablesAddtives = document.getElementsByTagName('table');

            var tbodyTableTopings = tablesAddtives[0].children[1];
            var tbodyTableStaffings = tablesAddtives[1].children[1];

            var buttons = document.querySelectorAll('[type="button"]');
            var count = document.getElementById('count');
            count.setAttribute('min', "1");
            count.setAttribute('max', "50");
            count.value = 1;
            var total = document.querySelector('div.col-xs-4.form-control-static.text-center');
            var It = document.querySelector('button.btn.btn-lg.btn-success');
            var container = document.getElementsByClassName('container');

            It.addEventListener("click", createCheck(container));

            document.getElementById('selectSmallSize').onclick = function() {
                var newHamburger = document.getElementById("newHamburger");
                newHamburger.style.display = 'none';

                hamburger = new Hamburger(Hamburger.SIZE_SMALL, Hamburger.STUFFING_CHEESE);


                listInfoBlock[0].textContent = "Small";

                updateInfoBlock(listInfoBlock, hamburger);
                updateTableAddtives(tbodyTableTopings, topings, hamburger.arrayTopping);
                updateTableAddtives(tbodyTableStaffings, stuffings, hamburger.arrayStaffing);

                var hamburgerFilling = document.getElementById("hamburgerFilling");
                hamburgerFilling.style.display = 'block';

                hamburgerPrice = (hamburger.calculatePrice() + hamburger.getSize().price).toFixed(2);

                total.textContent = "$"+hamburgerPrice;

            };

            document.getElementById('selectLargeSize').onclick = function() {
                var newHamburger = document.getElementById("newHamburger");
                newHamburger.style.display = 'none';

                hamburger = new Hamburger(Hamburger.SIZE_LARGE, Hamburger.STUFFING_POTATO);

                listInfoBlock[0].textContent = "Large";

                updateInfoBlock(listInfoBlock, hamburger);
                updateTableAddtives(tbodyTableTopings, topings, hamburger.arrayTopping);
                updateTableAddtives(tbodyTableStaffings, stuffings, hamburger.arrayStaffing);

                var hamburgerFilling = document.getElementById("hamburgerFilling");
                hamburgerFilling.style = "display : block";

                hamburgerPrice = (hamburger.calculatePrice() + hamburger.getSize().price).toFixed(2);

                total.textContent = "$"+hamburgerPrice;
            };

            topings.addEventListener("click", function(event) {
                var target = event.target;
                while (target != this) {
                    if (target.tagName == 'LI') {
                        var toppingName = target.textContent;
                        hamburger.addTopping(addtives[toppingName]);
                        topings.removeChild(target);
                        if(topings.children.length === 0)
                        {
                            buttons[0].disabled = true;
                        }
                        var length = hamburger.getToppings().length;

                        var tr = createTr();

                        tr[1].textContent = length;
                        tr[2].textContent = toppingName;
                        tr[3].textContent = "$" + (hamburger.arrayTopping[length-1].price).toFixed(2);

                        tbodyTableTopings.appendChild(tr[0]);
                        updateInfoBlock(listInfoBlock, hamburger);
                        return;
                    }
                    target = target.parentNode;
                }
            });
            stuffings.addEventListener("click", function(event) {
                var target = event.target;
                while (target != this) {
                    if (target.tagName == 'LI') {
                        var staffingName = target.textContent;
                        hamburger.addStuffing(addtives[staffingName]);
                        stuffings.removeChild(target);

                        if(stuffings.children.length === 0) {
                            buttons[1].disabled = true;
                        }

                        var length = hamburger.arrayStaffing.length;

                        var tr = createTr();

                        tr[1].textContent = length;
                        tr[2].textContent = staffingName;
                        tr[3].textContent = "$" + (hamburger.arrayStaffing[length-1].price).toFixed(2);

                        tbodyTableStaffings.appendChild(tr[0]);
                        updateInfoBlock(listInfoBlock, hamburger);
                        return;
                    }
                    target = target.parentNode;
                }
            });

            tbodyTableTopings.addEventListener("click", function(event){
                var target = event.target;
                while (target != this) {
                    if (target.tagName == 'BUTTON') {
                        if(topings.children.length === 0) {
                            buttons[0].disabled = false;
                        }
                        var td = target.parentElement;
                        var tr = td.parentElement;
                        var toppingName = tr.children[1].textContent;
                        hamburger.removeTopping(addtives[toppingName]);
                        var li = document.createElement('li');
                        var a = document.createElement('a');
                        a.setAttribute('href', '#');
                        a.textContent = toppingName;
                        li.appendChild(a);
                        topings.appendChild(li);
                        updateTableAddtives(tbodyTableTopings, topings, hamburger.arrayTopping);
                        updateInfoBlock(listInfoBlock, hamburger);
                        return
                    }
                    target = target.parentNode;
                }
            });

            tbodyTableStaffings.addEventListener("click", function(event){
                var target = event.target;
                while (target != this) {
                    if (target.tagName == 'BUTTON') {
                        if(stuffings.children.length === 0) {
                            buttons[1].disabled = false;
                        }
                        var td = target.parentElement;
                        var tr = td.parentElement;
                        var stuffingName = tr.children[1].textContent;
                        hamburger.removeStuffing(addtives[stuffingName]);
                        var li = document.createElement('li');
                        var a = document.createElement('a');
                        a.setAttribute('href', '#');
                        a.textContent = stuffingName;
                        li.appendChild(a);
                        stuffings.appendChild(li);
                        updateTableAddtives(tbodyTableStaffings, stuffings, hamburger.arrayStaffing);
                        updateInfoBlock(listInfoBlock, hamburger);
                        return
                    }
                    target = target.parentNode;
                }
            });

            count.addEventListener('click', function(event){
                var hamburgerPrice = (hamburger.calculatePrice() + hamburger.getSize().price).toFixed(2);
                total.textContent = "$"+(hamburgerPrice * count.value).toFixed(2);

            });
            count.addEventListener('keydown', function(event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    count.value = count.value > 50 ? 50 : count.value;
                    count.value = count.value < 1 ? 1 : count.value;
                    var hamburgerPrice = (hamburger.calculatePrice() + hamburger.getSize().price).toFixed(2);
                    total.textContent = "$"+(hamburgerPrice * count.value).toFixed(2);


                }
            });



        });

        function updateTableAddtives(tbodyTable, list, array) {
            var numberChildren = tbodyTable.children.length
            for (var j = 0; j < numberChildren; j++) {
                tbodyTable.removeChild(tbodyTable.children[0]);
            }



            for(var i = 0; i < array.length; i++) {
                var tr = createTr();
                tr[1].textContent = i+1;

                for (var property in addtives){
                    if(addtives[property] === array[i]){
                        tr[2].textContent = property;
                        break;
                    }
                }
                tr[3].textContent = "$" + (array[i].price).toFixed(2);

                tbodyTable.appendChild(tr[0]);

                var currentElement = tr[0].children[1].textContent;
                for (var j = 0; j < list.children.length; j++){
                    var elementName = list.children[j].textContent;
                    if(elementName === currentElement){
                        list.removeChild(list.children[j]);
                        break;
                    }
                }
            }


        };

        function updateInfoBlock(list, hamburger) {
            list[1].textContent = hamburger.arrayTopping.length;
            list[2].textContent = hamburger.arrayStaffing.length;
            list[3].textContent = hamburger.calculateCalories() + hamburger.getSize().calories;
            hamburgerPrice = (hamburger.calculatePrice() + hamburger.getSize().price).toFixed(2);
            list[4].textContent = "$"+hamburgerPrice;
        };
        function createTr() {
            var arrayTd = [
                document.createElement('tr'),
                document.createElement('td'),
                document.createElement('td'),
                document.createElement('td'),
                document.createElement('td'),
                document.createElement('button'),
                document.createElement('span')
            ];

            arrayTd[2].style = "width : 50%";
            arrayTd[3].style = "width : 50%";
            arrayTd[4].style = "width : auto";
            arrayTd[5].classList.add("btn","btn-sm", "btn-danger");
            arrayTd[6].classList.add("glyphicon", "glyphicon-remove");

            arrayTd[0].appendChild(arrayTd[1]);
            arrayTd[0].appendChild(arrayTd[2]);
            arrayTd[0].appendChild(arrayTd[3]);
            arrayTd[0].appendChild(arrayTd[4]);
            arrayTd[4].appendChild(arrayTd[5]);
            arrayTd[5].appendChild(arrayTd[6]);

            return arrayTd;
        }
        var addtives = {
            Mayo : Hamburger.TOPPING_MAYO,
            Spice : Hamburger.TOPPING_SPICE,
            Cheese : Hamburger.STUFFING_CHEESE,
            Salad : Hamburger.STUFFING_SALAD,
            Potato : Hamburger.STUFFING_POTATO
        };

        function createCheck(container) {
            return function () {
                var test = document.getElementById('check');

                if (test) {
                    container[0].removeChild(test);
                }

                var table = document.createElement('table');
                var headSize = document.createElement('th');
                var headStuffing = document.createElement('th');
                var headTopping = document.createElement('th');
                var stuffings = hamburger.getSuffring();
                var toppings = hamburger.getToppings();
                var countTr = document.createElement('tr');
                var countTdOne = document.createElement('td');
                var countTdTwo = document.createElement('td');
                var total = hamburger.calculatePrice() * count.value;

                table.id = 'check';
                table.style = 'margin: 0 auto;';
                headSize.textContent = 'Size';
                headStuffing.textContent = 'Stuffings';
                headTopping.textContent = 'Toppings';
                countTdOne.textContent = 'Count';
                countTdTwo.textContent = count.value;
                countTr.style = 'border-top: 1px solid black';
                countTdTwo.style = 'padding-left: 10px';

                table.appendChild(headTopping);

                if (toppings.length !== 0) {
                    for (var i = 0; i < toppings.length; i++) {
                        table.appendChild( createTrTd(toppings[i].name, toppings[i].price) );
                    }
                } else {
                    table.appendChild( emptyTrTd() );
                }

                table.appendChild(headStuffing);

                if (stuffings.length !== 0) {
                    for (var i = 0; i < stuffings.length; i++) {
                        table.appendChild( createTrTd(stuffings[i].name, stuffings[i].price) );
                    }
                } else {
                    table.appendChild( emptyTrTd() );
                }

                table.appendChild(headSize);
                table.appendChild( createTrTd(hamburger.size.name, hamburger.size.price) );
                table.appendChild( createTrTd('Price', hamburger.calculatePrice()) );

                countTr.appendChild(countTdOne);
                countTr.appendChild(countTdTwo);

                table.appendChild(countTr);
                table.appendChild( createTrTd('Total', total) );

                container[0].appendChild(table);
            }
        }

        //создание строки для таблицы "чека"
        function createTrTd(name, price) {
            var tr = document.createElement('tr');
            var tdOne = document.createElement('td');
            var tdTwo = document.createElement('td');

            tdOne.textContent = name;
            tdTwo.textContent = '$' + price.toFixed(2);
            tdTwo.style = 'padding-left: 10px';

            tr.appendChild(tdOne);
            tr.appendChild(tdTwo);

            return tr;
        }

        //создание "пустой" строки для таблицы "чека"
        function emptyTrTd() {
            emptyTr = document.createElement('tr');
            emptyTd = document.createElement('td');

            emptyTd.textContent = 'none';
            emptyTd.style = 'text-align: center;';

            emptyTr.appendChild(emptyTd);

            return emptyTr;
        }
    </script>

</div>
</body>
</html>
